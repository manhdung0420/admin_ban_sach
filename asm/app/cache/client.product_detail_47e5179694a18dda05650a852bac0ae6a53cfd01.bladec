<?php $_shouldextend[1]=1; ?>

<?php $this->startSection('title', 'Chi Tiết Sản Phẩm'); ?>

<?php $this->startSection('content'); ?>
<div class="container py-4">
 <!-- Sản phẩm -->
 <div class="row bg-light shadow-lg p-4 rounded">


 <div class="col-md-6 text-center">
 <img src="<?php echo \htmlentities(APP_URL . $product->image??'', ENT_QUOTES, 'UTF-8', false); ?>" style="width: 500px; height: 400px;" ; class="img-fluid rounded shadow-lg border border-primary" alt="<?php echo \htmlentities($product->product_name??'', ENT_QUOTES, 'UTF-8', false); ?>" style="max-width: 80%;">
 </div>

 <div class="col-md-6">
 <h2 class="fw-bold text-primary"><?php echo \htmlentities($product->product_name??'', ENT_QUOTES, 'UTF-8', false); ?></h2>

 <!-- Hiển thị giá -->
 <p class="fs-4">
 <?php if($product->promotional_price && $product->promotional_price < $product->price): ?>
 <span class="text-danger fw-bold"><?php echo \htmlentities(number_format($product->promotional_price, 0, ',', '.')??'', ENT_QUOTES, 'UTF-8', false); ?>đ</span>
 <del class="text-muted ms-2"><?php echo \htmlentities(number_format($product->price, 0, ',', '.')??'', ENT_QUOTES, 'UTF-8', false); ?>đ</del>
 <?php else: ?>
 <span class="text-danger fw-bold"><?php echo \htmlentities(number_format($product->price, 0, ',', '.')??'', ENT_QUOTES, 'UTF-8', false); ?>đ</span>
 <?php endif; ?>
 </p>

 <!-- Đánh giá sản phẩm -->
 <p class="Rating">Đánh giá:
 <select class="rounded border-1 p-1" name="rating" id="rating">
 <option value="1">1 ⭐</option>
 <option value="2">2 ⭐⭐</option>
 <option value="3">3 ⭐⭐⭐</option>
 <option value="4">4 ⭐⭐⭐⭐</option>
 <option value="5" selected>5 ⭐⭐⭐⭐⭐</option>
 </select>
 </p>

 <!-- Mô tả sản phẩm -->
 <p class="text-muted"><?php echo \htmlentities($product->description??'', ENT_QUOTES, 'UTF-8', false); ?></p>

 <!-- Chọn số lượng -->
 <div class="d-flex align-items-center gap-2 mt-3">
 <label for="quantity" class="fw-bold">Số lượng:</label>
 <input type="number" id="quantity" name="quantity" min="1" value="1" class="form-control text-center border-secondary" style="width: 80px;">
 </div>

 <!-- Nút thao tác -->
 <div class="d-flex gap-3 mt-4">
 <a href="<?php echo \htmlentities(APP_URL . 'cart'??'', ENT_QUOTES, 'UTF-8', false); ?>" class="btn btn-success btn-lg px-4 shadow">
 <i class="bi bi-cart-plus"></i> Thêm vào giỏ hàng
 </a>
 <a href="thanh-toan.php" class="btn btn-danger btn-lg px-4 shadow">
 <i class="bi bi-lightning-fill"></i> Mua ngay
 </a>
 </div>

 </div>

 </div>


 <!-- Bình luận sản phẩm -->
 <div class="mt-5">
 <h3 class="fw-bold text-info mb-3">💬 Bình luận</h3>
 <div class="bg-white shadow p-4 rounded">
 <!-- Form bình luận -->
 <form method="POST" action="<?php echo \htmlentities(APP_URL .'product/comment'??'', ENT_QUOTES, 'UTF-8', false); ?>">
 <input type='hidden' name='<?php  echo '_token'; ?>' value='<?php echo $this->csrf_token; ?>'/>
 <div class="mb-3">
 <textarea class="form-control" name="comment" rows="3" placeholder="Viết bình luận của bạn..." required></textarea>
 </div>
 <button type="submit" class="btn btn-primary">Gửi bình luận</button>
 </form>

 <!-- Danh sách bình luận -->
 <!-- <div class="mt-4">
 <?php $__currentLoopData = $comments; $this->addLoop($__currentLoopData);$this->getFirstLoop();
 foreach($__currentLoopData as $comment): $loop = $this->incrementLoopIndices();  ?>
 <div class="d-flex align-items-start mb-3">
 <img src="<?php echo \htmlentities($comment->user->avatar ?? 'https://via.placeholder.com/50'??'', ENT_QUOTES, 'UTF-8', false); ?>" class="rounded-circle me-3" width="50" height="50" alt="User">
 <div class="bg-light p-3 rounded shadow-sm" style="flex: 1;">
 <h6 class="fw-bold"><?php echo \htmlentities($comment->user->name??'', ENT_QUOTES, 'UTF-8', false); ?></h6>
 <p class="mb-1"><?php echo \htmlentities($comment->content??'', ENT_QUOTES, 'UTF-8', false); ?></p>
 <small class="text-muted"><?php echo \htmlentities($comment->created_at->diffForHumans()??'', ENT_QUOTES, 'UTF-8', false); ?></small>
 </div>
 </div>
 <?php endforeach; $this->popLoop(); $loop = $this->getFirstLoop(); ?>
 </div> -->
 </div>
 </div>

 <!-- Sản phẩm liên quan -->
 <div class="mt-5">
 <h3 class="fw-bold text-secondary mb-3">🔹 Sản phẩm liên quan</h3>
 <div class="row">
 <?php $__currentLoopData = $relatedProducts; $this->addLoop($__currentLoopData);$this->getFirstLoop();
 foreach($__currentLoopData as $related): $loop = $this->incrementLoopIndices();  ?>
 <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
 <div class="card shadow-sm border-0 h-100 overflow-hidden" style="border-radius: 10px; transition: 0.3s;">
 <img src="<?php echo \htmlentities(APP_URL . $related->image??'', ENT_QUOTES, 'UTF-8', false); ?>" class="card-img-top" alt="<?php echo \htmlentities($related->product_name??'', ENT_QUOTES, 'UTF-8', false); ?>" style="height: 200px; object-fit: cover;">
 <div class="card-body text-center">
 <h6 class="fw-bold"><?php echo \htmlentities($related->product_name??'', ENT_QUOTES, 'UTF-8', false); ?></h6>
 <p class="mb-2">
 <?php if($related->promotional_price && $related->promotional_price < $related->price): ?>
 <span class="text-danger fw-bold"><?php echo \htmlentities(number_format($related->promotional_price, 0, ',', '.')??'', ENT_QUOTES, 'UTF-8', false); ?>đ</span>
 <del class="text-muted ms-2"><?php echo \htmlentities(number_format($related->price, 0, ',', '.')??'', ENT_QUOTES, 'UTF-8', false); ?>đ</del>
 <?php else: ?>
 <span class="text-danger fw-bold"><?php echo \htmlentities(number_format($related->price, 0, ',', '.')??'', ENT_QUOTES, 'UTF-8', false); ?>đ</span>
 <?php endif; ?>
 </p>
 <a href="<?php echo \htmlentities(APP_URL .'product/detail/'. $related->id??'', ENT_QUOTES, 'UTF-8', false); ?>" class="btn btn-sm btn-outline-primary">Xem chi tiết</a>
 </div>
 </div>
 </div>
 <?php endforeach; $this->popLoop(); $loop = $this->getFirstLoop(); ?>
 </div>
 </div>



</div>
<?php $this->stopSection(); ?>
<?php if (isset($_shouldextend[1])) { echo $this->runChild('client.layout'); } ?>